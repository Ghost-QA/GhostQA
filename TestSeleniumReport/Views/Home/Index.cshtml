<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" crossorigin="anonymous" />
<div class="container-fluid">
    <div class="row p-2 test-run-container" id="TestRun">
        <div class="col-md-4 m-2 p-2 shadow-lg">
            <span class="fw-bold mb-2">Test Suite</span>
            <input id="testsuitessearch" type="text" class="border col-md-12 input-box" onkeyup="filterTestSuites()" placeholder="Search Test Suite..." />
            <hr />
            <div class="testsuites">
                @{
                    if (ViewBag.TestSuites != null)
                    {
                        var testSuiteList = Newtonsoft.Json.JsonConvert.DeserializeObject<List<TestSeleniumReport.DTO_s.Dto_TestSuites>>(ViewBag.TestSuites);
                        foreach (var item in testSuiteList)
                        {
                            <button id="testSuites_@item.TestSuiteName" type="button" class="btn accordion-gray col-md-12 mb-2 testSuite_Clickable text-lg-start" onclick="GetDashboardDetails(this.innerText)">@item.TestSuiteName</button>
                        }
                    }
                }
            </div>
        </div>
        <div id="runId" class="col m-2 shadow-lg p-2">
            <span class="fw-bold">Test Run</span>
            <div class="card-header-tabs card-header">
                <ul class="nav nav-tabs">
                    <li class="nav-item">
                        <a class="nav-link text-dark active dash" aria-current="page" href="#" onclick="showTab('dash')">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-dark hist" href="#" onclick="showTab('hist')">History</a>
                    </li>
                </ul>
                <div id="dash" class="m-2 mt-1 tab-content active">
                    <div id="testRunChartContainer">
                    </div>
                </div>

                <div id="hist" class="m-2 mt-1 tab-content">
                    <div id="testRunListContainer">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="TestRunDetails">
        <div id="CaseId" class="m-2 shadow-lg p-2">
            <div id="testcaseChartContainer">
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        $('#TestRun').show();
        $('#TestRunDetails').hide();
        $('#runId').hide();
    });

    function showTab(tabId) {
        var tabContents = document.querySelectorAll('.tab-content');
        $(".dash").removeClass("active item-selected");
        $(".hist").removeClass("active item-selected");

        var selector = '.' + tabId;
        $(selector).addClass("active item-selected");

        $('.tab-content').hide();
        $('#' + tabId).show();
    }

    function filterTestSuites(event) {
        var input = document.getElementById("testsuitessearch");
        var filter = input.value.toLowerCase();
        var nodes = document.getElementsByClassName('testsuites');

        for (i = 0; i < nodes.length; i++) {
            if (nodes[i].innerText.toLowerCase().includes(filter)) {
                nodes[i].style.display = "block";
            } else {
                nodes[i].style.display = "none";
            }
        }
    }

    function GetDashboardDetails(testSuitesName) {
        $.ajax({
            url: '@Url.Action("GetDashboardDetails", "Home")',
            data: { testSuitName: testSuitesName },
            success: function (result) {
                $('#testRunChartContainer').html(result);
                $('#runId').show();
                GetRunDetails(testSuitesName)
            }
        });
    };

    function GetRunDetails(testSuitesName) {
        $.ajax({
            url: '@Url.Action("GetRunDetails", "Home")',
            data: { testSuitName: testSuitesName },
            success: function (result) {
                $('#testRunListContainer').html(result);
                $('#runId').show();
                $(".testSuite_Clickable").removeClass("item-selected");
                var selector = '#testSuites_' + testSuitesName;
                $(selector).addClass("item-selected");
            }
        });
    };

    function GetTestCaseDetails(testSuitesName, runId) {
        $.ajax({
            url: '@Url.Action("GetTestCaseDetails", "Home")',
            data: { testSuitName: testSuitesName, runId: runId },
            Type: "Post",
            success: function (result) {
                $('#testcaseChartContainer').html(result);
                $(".testRunId_Clickable").removeClass("item-selected");
                var selector = '#runId_' + testSuitesName + runId;
                $(selector).addClass("item-selected");
                $('#TestRun').hide();
                $('#TestRunDetails').show();
            }
        });
    };

    function toggleContent(id) {
        var content = document.getElementById(id);
        if (content.style.display === "block") {
            content.style.display = "none";
            $("#" + id).removeClass("item-selected");
        } else {
            content.style.display = "block";
            $("#" + id).addClass("item-selected");
        }
    };

    function Back() {
        $('#TestRun').show();
        $('#TestRunDetails').hide();
    };

    function showVideoPopup(testcaseName) {
        $('#videoModal-' + testcaseName).modal('show');
    };

    function closeModal(testcaseName) {
        $('#' + testcaseName).modal('hide');
    };
    function showImagePopup(testcaseName) {
        $('#imgModal').modal('show');
    };

    function closeImageModal(testcaseName) {
        $('#imgModal').modal('hide');
    };
</script>
